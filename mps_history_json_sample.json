/* History Collection v5, added type and card_number to bypass*/
// for each sub-document, the fields under its type is all you need. Ex: if type is fault, then there is no need for 'bypass' and 'channel' info.
{
    "id": 1,                    // Primary Key of json object 
    "type": "",                 // history type - ex's: ['channel', 'bypass', 'fault']
    "timestamp": "",            // Timestamp of fault event. Format to work with sqlite date/time functions: "YYYY-MM-DD HH:MM:SS.SSS - ex: '2023-7-11 04:25:21.52134'
    "old_state": "",            // State transitioned from fault event - ex's: ['OPEN', 'active', 'expired', '0x1']
    "new_state": "",            // State transitioned to in fault event - ex's: ['OPEN', 'active', 'expired', '0x1']
    "channel": {        
        "number": 1,            // Channel number - ex's: [2, 32, 10]
        "name": "",             // Channel name - ex's: ['SOLN:GUNB:212:TEMP_PERMIT', 'BPMS:L2B:1283:X', 'BPMS:BPN28:200:X']
        "card_number": 1,       // Application Card number - ex's: [1, 5, 104]
        "crate_loc": ""         // Crate location - ex's: ['L2KA00-0517', 'B921-1524']
    },
    "bypass": {
        "type": "",             // Bypass type - ['fault', 'application']
        "expiration": "",       // Expiration timestamp - "YYYY-MM-DD HH:MM:SS.SSS - ex: '2023-7-11 04:25:21.52134', central node will send time in (seconds) and history server does expiration = timestamp(exp_time(central_node) + cur_time)
        "description": "",      // Description of fault - ex's: ['SOL1B LINAC Solenoid BACT Fault', 'Mech Shutter Fault'      
        "card_number": ""       // Application Card number - ex's: [1, 5, 104]
    },
    "fault": {
        "id": 1,                // Fault id - ex's: [2, 4, 1]
        "description": "",      // Description of fault - ex's: ['SOL1B LINAC Solenoid BACT Fault', 'Mech Shutter Fault'
        "beams": [               // List of beam_classes and beam_destinations, amount is >= 1 beam objects
            {
                "class": "",       // Beam class name - ex's: ['BC0', 'BC1', 'FULL']
                "destination": ""  // Beam destination name - ex's: ['LINAC', 'SC_DIAG0', 'ALL']
            }
        ],
        "active": true          // Fault active boolean - ex's: [true, false]
    }
}

/* Examples */

{
    "type": "channel",
    "timestamp": "2023-10-02 10:21:51.822255",
    "old_state": "IS_FAULTED",
    "new_state": "IS_OK",
    "channel": {
        "number": 9,
        "name": "COLL:COL1:470:TEMP_PERMIT",
        "card_number": 43,
        "crate_loc": "L2KG02-2215"
    }
}

{ // Digital Fault Bypass
    "type": "bypass",
    "timestamp": "2023-10-02 10:21:51.832728", 
    "new_state": "IS_NOT_IGNORED", 
    "bypass": {
        "type": "fault",
        "expiration": "2023-10-02 10:22:41.000000",
        "description": "CMB19 (BPMS:L3B:1983) TMIT Fault"
    }
}

{ // Analog Fault Bypass
    "type": "bypass",
    "timestamp": "2023-11-13 14:00:21.307799",
    "bypass": {
    "type": "fault",
        "expiration": "2023-11-13 14:01:01.000000",
        "description": "SOL1B B-Field (SOLN:GUNB:212) Fault"
    }
}

{
    "type": "bypass",
    "timestamp": "2023-10-02 10:21:51.832728", 
    "bypass": {
        "type": "application",
        "expiration": "2023-10-02 10:22:41.000000",
        "card_number": 2
    }
}

{
    "type": "fault",
    "timestamp": "2023-11-09 13:48:04.281221",
    "old_state": "Is Faulted",
    "new_state": "Is Ok",
    "fault": 
    {
        "id": 17,
        "description": "SOL1B (SOLN:GUNB:212) Temperature Interlock",
        "active": true,
        "beams": [
            {"class": "Full", "destination": "LASER"},
            {"class": "Full", "destination": "SC_DIAG0"},
            {"class": "Full", "destination": "SC_BSYD"},
            {"class": "Full", "destination": "SC_HXR"},
            {"class": "Full", "destination": "SC_SXR"},
            {"class": "Full", "destination": "SC_LESA"},
            {"class": "Full", "destination": "LASER_HTR"},
            {"class": "Full", "destination": "MECH_SHUTTER"}
        ]
    }
}

/* History Collection v4, added description to bypass*/
// for each sub-document, the fields under its type is all you need. Ex: if type is fault, then there is no need for 'bypass' and 'channel' info.
{
    "id": 1,                    // Primary Key of json object 
    "type": "",                 // history type - ex's: ['channel', 'bypass', 'fault']
    "timestamp": "",            // Timestamp of fault event. Format to work with sqlite date/time functions: "YYYY-MM-DD HH:MM:SS.SSS - ex: '2023-7-11 04:25:21.52134'
    "old_state": "",            // State transitioned from fault event - ex's: ['OPEN', 'active', 'expired', '0x1']
    "new_state": "",            // State transitioned to in fault event - ex's: ['OPEN', 'active', 'expired', '0x1']
    "channel": {        
        "number": 1,            // Channel number - ex's: [2, 32, 10]
        "name": "",             // Channel name - ex's: ['SOLN:GUNB:212:TEMP_PERMIT', 'BPMS:L2B:1283:X', 'BPMS:BPN28:200:X']
        "card_number": 1,       // Application Card number - ex's: [1, 5, 104]
        "crate_loc": ""         // Crate location - ex's: ['L2KA00-0517', 'B921-1524']
    },
    "bypass": {
        "expiration": "",       // Expiration timestamp - "YYYY-MM-DD HH:MM:SS.SSS - ex: '2023-7-11 04:25:21.52134', central node will send time in (seconds) and history server does expiration = timestamp(exp_time(central_node) + cur_time)
        "description": ""       // Description of fault - ex's: ['SOL1B LINAC Solenoid BACT Fault', 'Mech Shutter Fault'      
    },
    "fault": {
        "id": 1,                // Fault id - ex's: [2, 4, 1]
        "description": "",      // Description of fault - ex's: ['SOL1B LINAC Solenoid BACT Fault', 'Mech Shutter Fault'
        "beams": [               // List of beam_classes and beam_destinations, amount is >= 1 beam objects
            {
                "class": "",       // Beam class name - ex's: ['BC0', 'BC1', 'FULL']
                "destination": ""  // Beam destination name - ex's: ['LINAC', 'SC_DIAG0', 'ALL']
            }
        ],
        "active": true          // Fault active boolean - ex's: [true, false]
    }
}


/* History Collection v3.1 - changed channel name and number to list*/
{
    "id": 1,                    // Primary Key of json object 
    "type": "",                 // history type - ex's: ['analog', 'bypass', 'fault', 'input']
    "timestamp": "",            // Timestamp of fault event. Format to work with sqlite date/time functions: "YYYY-MM-DD HH:MM:SS.SSS - ex: '2023-7-11 04:25:21.52134'
    "old_state": "",            // State transitioned from fault event - ex's: ['OPEN', 'active', 'expired', '0x1']
    "new_state": "",            // State transitioned to in fault event - ex's: ['OPEN', 'active', 'expired', '0x1']
    "card_number": 1,           // Application Card number - ex's: [1, 5, 104]
    "crate_loc": "",            // Crate location - ex's: ['L2KA00-0517', 'B921-1524']
    "channels": [
        {
        "number": "",            // Channel number - ex's: [2, 32, 10]
        "name": ""             // Channel name - ex's: ['SOLN:GUNB:212:TEMP_PERMIT', 'BPMS:L2B:1283:X', 'BPMS:BPN28:200:X']
        }
    ],
    "bypass": {
        "expiration": ""        // Expiration timestamp - "YYYY-MM-DD HH:MM:SS.SSS - ex: '2023-7-11 04:25:21.52134' sent from central node (in seconds), and history server will convert to timestamp from current time (close enough)
    },
    "fault": {
        "id": 1,                // Fault id - ex's: [2, 4, 1]
        "description": "",      // Description of fault - ex's: ['SOL1B LINAC Solenoid BACT Fault', 'Mech Shutter Fault'
        "beams": [               // List of beam_classes and beam_destinations, amount is >= 1 beam objects
            {
                "class": "",       // Beam class name - ex's: ['BC0', 'BC1', 'FULL']
                "destination": ""  // Beam destination name - ex's: ['LINAC', 'SC_DIAG0', 'ALL']
            }
        ],
        "active": true          // Fault active boolean - ex's: [true, false]
    }
}
